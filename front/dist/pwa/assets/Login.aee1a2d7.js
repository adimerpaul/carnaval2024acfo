import{c as Q,r as B,s as F,H as E,I as A,o as N,h as R,e as U,j,aU as L,x as P,g as O,an as $,aV as D,_ as J,S as K,T,U as f,X as c,V as d,aK as W,aW as V,Q as z,W as q,aJ as H}from"./index.e9d96991.js";import{Q as M}from"./QPage.4dbd8d19.js";import{a as I}from"./axios.40c67973.js";var X=Q({name:"QForm",props:{autofocus:Boolean,noErrorFocus:Boolean,noResetFocus:Boolean,greedy:Boolean,onSubmit:Function},emits:["reset","validationSuccess","validationError"],setup(o,{slots:i,emit:m}){const g=j(),a=B(null);let l=0;const s=[];function h(e){const u=typeof e=="boolean"?e:o.noErrorFocus!==!0,p=++l,_=(t,n)=>{m("validation"+(t===!0?"Success":"Error"),n)},k=t=>{const n=t.validate();return typeof n.then=="function"?n.then(r=>({valid:r,comp:t}),r=>({valid:!1,comp:t,err:r})):Promise.resolve({valid:n,comp:t})};return(o.greedy===!0?Promise.all(s.map(k)).then(t=>t.filter(n=>n.valid!==!0)):s.reduce((t,n)=>t.then(()=>k(n).then(r=>{if(r.valid===!1)return Promise.reject(r)})),Promise.resolve()).catch(t=>[t])).then(t=>{if(t===void 0||t.length===0)return p===l&&_(!0),!0;if(p===l){const{comp:n,err:r}=t[0];if(r!==void 0&&console.error(r),_(!1,n),u===!0){const w=t.find(({comp:C})=>typeof C.focus=="function"&&L(C.$)===!1);w!==void 0&&w.comp.focus()}}return!1})}function b(){l++,s.forEach(e=>{typeof e.resetValidation=="function"&&e.resetValidation()})}function y(e){e!==void 0&&P(e);const u=l+1;h().then(p=>{u===l&&p===!0&&(o.onSubmit!==void 0?m("submit",e):e!==void 0&&e.target!==void 0&&typeof e.target.submit=="function"&&e.target.submit())})}function x(e){e!==void 0&&P(e),m("reset"),O(()=>{b(),o.autofocus===!0&&o.noResetFocus!==!0&&v()})}function v(){$(()=>{if(a.value===null)return;const e=a.value.querySelector("[autofocus][tabindex], [data-autofocus][tabindex]")||a.value.querySelector("[autofocus] [tabindex], [data-autofocus] [tabindex]")||a.value.querySelector("[autofocus], [data-autofocus]")||Array.prototype.find.call(a.value.querySelectorAll("[tabindex]"),u=>u.tabIndex>-1);e!=null&&e.focus({preventScroll:!0})})}F(D,{bindComponent(e){s.push(e)},unbindComponent(e){const u=s.indexOf(e);u>-1&&s.splice(u,1)}});let S=!1;return E(()=>{S=!0}),A(()=>{S===!0&&o.autofocus===!0&&v()}),N(()=>{o.autofocus===!0&&v()}),Object.assign(g.proxy,{validate:h,resetValidation:b,submit:y,reset:x,focus:v,getValidationComponents:()=>s}),()=>R("form",{class:"q-form",ref:a,onSubmit:y,onReset:x},U(i.default))}});const G={name:"LoginPage",data(){return{nickname:"",password:"",visiblePassword:!1,loading:!1}},mounted(){localStorage.getItem("tokenCarnaval")&&this.$router.push("/")},methods:{login(){this.loading=!0,I.post("/login",{nickname:this.nickname,password:this.password}).then(o=>{localStorage.setItem("tokenCarnaval",o.data.token),localStorage.setItem("user",JSON.stringify(o.data.user)),this.$router.push("/"),this.$store.isLogin=!0,this.$store.user=o.data.user,I.defaults.headers.common.Authorization=`Bearer ${o.data.token}`}).catch(o=>{console.log(o)}).finally(()=>{this.loading=!1})}}},Y={class:"row"},Z=c("div",{class:"col-12 col-md-3"},null,-1),ee={class:"col-12 col-md-6"},te={class:"q-pa-md"},oe=c("div",{class:"text-h6"},"Iniciar sesi\xF3n",-1),ae=c("div",{class:"col-12 col-md-3"},null,-1);function se(o,i,m,g,a,l){return K(),T(M,null,{default:f(()=>[c("div",Y,[Z,c("div",ee,[c("div",te,[d(H,{class:"q-pa-md"},{default:f(()=>[d(X,{onSubmit:l.login},{default:f(()=>[d(W,{class:"q-pa-md"},{default:f(()=>[oe,d(V,{class:"q-ma-xs",outlined:"",modelValue:a.nickname,"onUpdate:modelValue":i[0]||(i[0]=s=>a.nickname=s),label:"Nickname"},null,8,["modelValue"]),d(V,{class:"q-ma-xs",outlined:"",modelValue:a.password,"onUpdate:modelValue":i[2]||(i[2]=s=>a.password=s),label:"Contrase\xF1a",type:a.visiblePassword?"text":"password"},{append:f(()=>[d(z,{name:a.visiblePassword?"visibility_off":"visibility",onClick:i[1]||(i[1]=s=>a.visiblePassword=!a.visiblePassword)},null,8,["name"])]),_:1},8,["modelValue","type"]),d(q,{color:"primary",label:"Ingresar",type:"submit",class:"full-width q-ma-xs",loading:a.loading},null,8,["loading"]),d(q,{color:"primary",label:"Principal",onClick:i[3]||(i[3]=s=>o.$router.push("/")),class:"full-width q-ma-xs",outline:""})]),_:1})]),_:1},8,["onSubmit"])]),_:1})])]),ae])]),_:1})}var ue=J(G,[["render",se]]);export{ue as default};
